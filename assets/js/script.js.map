{"version":3,"sources":["../../js/script.js"],"names":[],"mappings":"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","file":"script.js","sourcesContent":["/* global Vivus */\n\nconst markerTemplate = (data) => `\n   <div class=\"pin\" id=\"${data.id || ''}\" style=\"left: ${data.left}; top: ${data.top};\">\n      <div class=\"circle\"></div>\n      <div class=\"glow\"></div>\n      <div class=\"more\">\n         <div class=\"content\">\n            ${data.content}\n         </div>\n      </div>\n   </div>\n`;\n\nclass App {\n\n   constructor() {\n      this.$ = window.jQuery;\n      this.marker = window.config.marker;\n      this.items = [];\n      this.amount = 0;\n      this.bonusName = window.config.bonusName;\n\n      this.$marker = this.$('.marker');\n      this.$result = this.$('.result');\n      this.$amount = this.$('.result .amount');\n      this.$resultMore = this.$('.result .more');\n      this.$items = this.$('.result .items');\n      this.$donateButton = this.$('.donate-button');\n\n      this.$amount.on('keyup', this.handleAmountChange.bind(this));\n      this.$marker.on('click', 'button', this.handleItemAddition.bind(this));\n\n      this.startIntro();\n   }\n\n   startIntro() {\n      this.runSVGAnimation('svg-lkw', () => {\n         const htmlItems = this.marker.map(markerTemplate);\n         this.$marker.html(htmlItems.join(''));\n         const firstPin = this.$('.pin .more').first();\n         this.animate(firstPin, 'glimpse');\n      });\n   }\n\n   render() {\n      this.$amount.val(this.amount);\n      this.renderItems();\n   }\n\n   handleAmountChange() {\n      this.amount = +this.$amount.val();\n      this.renderItems();\n   }\n\n   handleItemAddition({ target = {} }) {\n      const name = target.innerText;\n      const price = +target.dataset.price;\n      this.addProduct({ name, price });\n   }\n\n   addProduct(item) {\n      this.amount += item.price;\n      this.items = [...this.items, item].sort((a, b) => a.price - b.price);\n      this.render();\n      this.animate(this.$result, 'grow');\n   }\n\n   renderItems() {\n      let items = [...this.items];\n      let hasItems = !(this.amount > 0 || items.length);\n      let targetValue = this.calculateAmount();\n      let actualValue = this.$amount.val();\n      let itemTemplate = (item) => `<div class=\"item\" data-price=\"${item.price}\">${item.name}</div>`;\n\n      this.$resultMore.toggleClass('hidden', hasItems);\n      this.$donateButton.attr('disabled', hasItems);\n\n      if (items.length && actualValue < targetValue) {\n         let partlyOff = (item) => `<div class=\"item\">${item.name}\n                                         <div class=\"pull-right\"> ${item.newPrice} €\n                                            <span class=\"strike\">${item.price} €</span>\n                                         </div>\n                                      </div>`;\n         let fullyOff = (item) => `<div class=\"item strike\"><span data-price=\"${item.price}\">${item.name}</span></div>`;\n\n         let html = items.map((item) => {\n            let difference = targetValue - actualValue;\n\n            if (!difference) {\n               return itemTemplate(item); // normal\n            }\n\n            if (difference < item.price) { // partly off\n               targetValue -= difference;\n               item.newPrice = item.price - difference; // eslint-disable-line no-param-reassign\n               return partlyOff(item);\n            }\n\n            targetValue -= item.price;\n            return fullyOff(item); // fully off\n         }).join('');\n         this.$items.html(html);\n         return;\n      }\n\n      if (actualValue > targetValue) {\n         items.push({\n            name: this.bonusName,\n            price: actualValue - targetValue,\n         });\n      }\n\n      let itemsHtml = items.map(itemTemplate).join('');\n      let html = items.length ? itemsHtml : '';\n      this.$items.html(html);\n   }\n\n   calculateAmount() {\n      return this.items\n         .map(item => item.price)\n         .reduce((sum, price) => sum + price, 0);\n   }\n\n   animate($element, className, callback = this.$.noop) {\n      $element.addClass(className);\n      $element.one('animationend', () => {\n         $element.removeClass(className);\n         callback();\n      });\n   }\n\n   runSVGAnimation(id = '', callback = this.$.noop) {\n      const settings = window.config.vivusSettings;\n      this.$(`#${id}`).css('opacity', 1);\n      this.vivus = new Vivus(id, settings, callback);\n   }\n\n}\n\n$(() => window.app = new App()); // eslint-disable-line no-new, no-return-assign\n"]}