{"version":3,"sources":["../../js/script.js"],"names":[],"mappings":"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","file":"script.js","sourcesContent":["/* global Vivus */\n\nconst markerTemplate = (data) => `\n   <div class=\"pin\" id=\"${data.id || ''}\" style=\"left: ${data.left}; top: ${data.top};\">\n      <div class=\"circle\"></div>\n      <div class=\"glow\"></div>\n      <div class=\"more\">\n         <div class=\"content\" data-earmark=\"${data.earmark}\">\n            ${data.content}\n         </div>\n      </div>\n   </div>\n`;\n\nclass App {\n\n   constructor() {\n      this.$ = window.jQuery;\n      this.marker = window.config.marker;\n      this.items = [];\n      this.amount = 0;\n      this.bonusName = window.config.bonusName;\n\n      this.$marker = this.$('.marker');\n      this.$result = this.$('.result');\n      this.$amount = this.$('.result .amount');\n      this.$resultMore = this.$('.result .more');\n      this.$items = this.$('.result .items');\n      this.$infoBlock = this.$('.info-block');\n      this.$infoButtons = this.$('.info-buttons');\n      this.$donateButton = this.$('.donation-button');\n      this.$earmark = this.$('.donation-earmark');\n      this.$form = this.$('.donation-form');\n\n      this.$amount.on('keyup change', this.handleAmountChange.bind(this));\n      this.$marker.on('click', '.item', this.handleAddition.bind(this));\n      this.$items.on('click', '.item', this.handleRemoval.bind(this));\n      this.$form.on('submit', this.beforeSubmit.bind(this));\n      this.$infoButtons.on('click', '[data-view]', (event) => {\n         event.preventDefault();\n         this.changeInfobox(event.currentTarget.dataset.view);\n      });\n\n      this.changeInfobox(0);\n      this.startIntro();\n   }\n\n   startIntro() {\n      const id = 'svg-lkw';\n      const onReady = () => { this.$(`#${id}`).css('opacity', 1); };\n      const callback = () => {\n         const htmlItems = this.marker.map(markerTemplate);\n         this.$marker.html(htmlItems.join(''));\n         const firstPin = this.$('.pin .more').first();\n         this.animate(firstPin, 'glimpse');\n         this.adjustMarkerContentPositions();\n      };\n\n      if (window.innerWidth < 768 || /^((?!chrome).)*safari/i.test(window.navigator.userAgent)) {\n         onReady();\n         callback();\n      }\n      else {\n         this.runSVGAnimation(id, onReady, callback);\n      }\n   }\n\n   render() {\n      this.$amount.val(this.amount);\n      this.renderItems();\n   }\n\n   beforeSubmit() {\n      const counts = {};\n      this.items.forEach((item) => {\n         counts[item.earmark] = (counts[item.earmark] || 0) + item.price;\n      });\n      const earmark = Object.keys(counts).sort((a, b) => counts[b] - counts[a])[0];\n      this.$earmark.val(earmark || '');\n   }\n\n   changeInfobox(view) {\n      this.$infoBlock\n         .attr('data-view', view)\n         .find('.view')\n         .hide()\n         .eq(view)\n         .show();\n   }\n\n   handleAmountChange() {\n      this.amount = +this.$amount.val();\n      this.renderItems();\n   }\n\n   handleAddition({ currentTarget = {} }) {\n      const name = currentTarget.innerText;\n      const price = +currentTarget.dataset.price;\n      const earmark = currentTarget.parentElement.dataset.earmark;\n      this.addProduct({ name, price, earmark });\n   }\n\n   handleRemoval({ currentTarget = {} }) {\n      const name = currentTarget.innerText;\n      const price = +currentTarget.dataset.price;\n      this.removeProduct({ name, price });\n   }\n\n   addProduct(item) {\n      this.amount += item.price;\n      this.items = [...this.items, item].sort((a, b) => a.price - b.price);\n      this.render();\n      this.animate(this.$result, 'grow');\n   }\n\n   removeProduct({ name, price }) {\n      this.amount -= price;\n      const index = this.items.map(item => item.name).indexOf(name);\n      this.items.splice(index, 1);\n      this.render();\n   }\n\n   renderItems() {\n      const items = [...this.items];\n      const hasItems = !(this.amount > 0 || items.length);\n      const actualValue = this.$amount.val();\n      const itemTemplate = (item) => `<div class=\"item\" data-price=\"${item.price}\">\n                                         <span class=\"name\">${item.name}</span>\n                                      </div>`;\n      let targetValue = this.calculateAmount();\n\n      this.$resultMore.toggleClass('hidden', hasItems);\n      this.$donateButton.attr('disabled', hasItems);\n\n      if (items.length && actualValue < targetValue) {\n         const partlyOff = (item) => `<div class=\"item\"><span class=\"name\">${item.name}</span>\n                                       <div class=\"price\">${item.newPrice}&nbsp;€\n                                          <span class=\"strike\">${item.price}&nbsp;€</span>\n                                       </div>\n                                    </div>`;\n         const fullyOff = (item) => `<div class=\"item strike\">\n                                        <span class=\"name\">${item.name}</span>\n                                        <span data-price=\"${item.price}\"></span>\n                                     </div>`;\n\n         const html = items.map((item) => {\n            const difference = targetValue - actualValue;\n\n            if (!difference) {\n               return itemTemplate(item); // normal\n            }\n\n            if (difference < item.price) { // partly off\n               targetValue -= difference;\n               item.newPrice = item.price - difference; // eslint-disable-line no-param-reassign\n               return partlyOff(item);\n            }\n\n            targetValue -= item.price;\n            return fullyOff(item); // fully off\n         }).join('');\n         this.$items.html(html);\n         return;\n      }\n\n      if (actualValue > targetValue) {\n         items.push({\n            name: this.bonusName,\n            price: actualValue - targetValue,\n         });\n      }\n\n      const itemsHtml = items.map(itemTemplate).join('');\n      const html = items.length ? itemsHtml : '';\n      this.$items.html(html);\n   }\n\n   calculateAmount() {\n      return this.items\n         .map(item => item.price)\n         .reduce((sum, price) => sum + price, 0);\n   }\n\n   animate($element, className, callback = this.$.noop) {\n      $element.addClass(className);\n      $element.one('animationend', () => {\n         $element.removeClass(className);\n         callback();\n      });\n   }\n\n   runSVGAnimation(id = '', onReady = this.$.noop, callback = this.$.noop) {\n      const settings = window.config.vivusSettings;\n      settings.onReady = onReady;\n      this.vivus = new Vivus(id, settings, callback);\n   }\n\n   adjustMarkerContentPositions() {\n      this.$marker.find('.pin .content').each((index, element) => {\n         element.parentElement.style.display = 'block';\n         const bounds = element.getBoundingClientRect();\n         element.parentElement.style.display = '';\n         if (bounds.left < 0) {\n            element.style.left = `${Math.abs(bounds.left)}px`;\n         }\n         else if (window.innerWidth - bounds.right < 0) {\n            element.style.right = `${bounds.right - window.innerWidth}px`;\n         }\n      });\n   }\n\n}\n\n$(() => window.app = new App()); // eslint-disable-line no-new, no-return-assign\n"]}