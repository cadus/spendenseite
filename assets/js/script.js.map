{"version":3,"sources":["../../js/script.js"],"names":["markerTemplate","data","id","left","top","earmark","content","noop","report","category","action","label","value","window","ga","App","$","jQuery","marker","config","items","amount","bonusName","$marker","$result","$amount","$resultMore","$items","$infoBlock","$infoButtons","$donateButton","$earmark","$form","bindEvents","changeInfobox","startIntro","on","handleAddition","bind","handleRemoval","handleAmountChange","beforeSubmit","event","preventDefault","currentTarget","dataset","view","innerText","addClass","applyTouchDeviceLogic","removeActive","find","removeClass","stopPropagation","$target","target","$currentTarget","hasClass","toggleClass","$nav","slideToggle","onReady","css","callback","htmlItems","map","html","join","firstPin","first","animate","adjustMarkerContentPositions","innerWidth","test","navigator","userAgent","runSVGAnimation","val","renderItems","counts","forEach","item","price","Object","keys","sort","a","b","attr","hide","eq","show","name","parentElement","addProduct","removeProduct","render","index","indexOf","splice","hasItems","length","actualValue","itemTemplate","targetValue","calculateAmount","partlyOff","newPrice","fullyOff","difference","push","itemsHtml","reduce","sum","$element","className","one","settings","vivusSettings","vivus","Vivus","each","element","style","display","bounds","getBoundingClientRect","Math","abs","right","app"],"mappings":"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","file":"script.js","sourcesContent":["/* global Vivus */\n\nconst markerTemplate = (data) => `\n   <div class=\"pin\" id=\"${data.id || ''}\" style=\"left: ${data.left}; top: ${data.top};\">\n      <div class=\"glow\"></div>\n      <div class=\"circle\"></div>\n      <div class=\"more\">\n         <div class=\"content\" data-earmark=\"${data.earmark}\">\n            ${data.content}\n         </div>\n      </div>\n   </div>\n`;\n\nconst noop = () => {};\nconst report = (category = 'unknown', action = 'unknown', label, value) => {\n   (window.ga || noop)('send', 'event', category, action, label, value);\n};\n\nclass App {\n\n   constructor() {\n      this.$ = window.jQuery;\n      this.marker = window.config.marker;\n      this.items = [];\n      this.amount = 0;\n      this.bonusName = window.config.bonusName;\n\n      this.$marker = this.$('.marker');\n      this.$result = this.$('.result');\n      this.$amount = this.$('.result .amount');\n      this.$resultMore = this.$('.result .more');\n      this.$items = this.$('.result .items');\n      this.$infoBlock = this.$('.info-block');\n      this.$infoButtons = this.$('.info-buttons');\n      this.$donateButton = this.$('.donation-button');\n      this.$earmark = this.$('.donation-earmark');\n      this.$form = this.$('.donation-form');\n\n      this.bindEvents();\n      this.changeInfobox(0);\n      this.startIntro();\n   }\n\n   bindEvents() {\n      this.$marker.on('click', '.item', this.handleAddition.bind(this));\n      this.$items.on('click', '.item', this.handleRemoval.bind(this));\n      this.$amount.on('keyup change', this.handleAmountChange.bind(this));\n      this.$form.on('submit', this.beforeSubmit.bind(this));\n\n      this.$infoButtons.on('click', '[data-view]', (event) => {\n         event.preventDefault();\n         this.changeInfobox(event.currentTarget.dataset.view);\n         report('Infobox', 'changed', `Seite \"${event.currentTarget.innerText}\"`);\n      });\n\n      if ('ontouchstart' in window) {\n         $('body').addClass('touch-device');\n         this.applyTouchDeviceLogic();\n      }\n      else {\n         $('body').addClass('mouse-device');\n      }\n   }\n\n   applyTouchDeviceLogic() {\n      const removeActive = () => this.$marker.find('.pin.active').removeClass('active');\n\n      $(window).on('touchstart', removeActive);\n\n      this.$marker.on('touchstart', '.pin', (event) => {\n         event.stopPropagation();\n         const $target = this.$(event.target);\n         const $currentTarget = this.$(event.currentTarget);\n\n         if (!$currentTarget.hasClass('active')) {\n            removeActive();\n         }\n\n         if ($target.hasClass('circle') || $target.hasClass('glow')) {\n            $currentTarget.toggleClass('active');\n         }\n      });\n\n      // Wird anscheiend nicht mehr geladen, darum manuell\n      const $nav = this.$('.navbar-main-collapse');\n      this.$('.navbar-toggle').on('click', () => $nav.slideToggle());\n   }\n\n   startIntro() {\n      const id = 'svg-lkw';\n      const onReady = () => { this.$(`#${id}`).css('opacity', 1); };\n      const callback = () => {\n         const htmlItems = this.marker.map(markerTemplate);\n         this.$marker.html(htmlItems.join(''));\n         const firstPin = this.$('.pin .more').first();\n         this.animate(firstPin, 'glimpse');\n         this.adjustMarkerContentPositions();\n      };\n\n      if (window.innerWidth < 768 || /^((?!chrome).)*safari/i.test(window.navigator.userAgent)) {\n         onReady();\n         callback();\n      }\n      else {\n         this.runSVGAnimation(id,\n            () => { // on Ready\n               report('Animation', 'started');\n               onReady();\n            },\n            () => { // on Finish\n               report('Animation', 'ended');\n               callback();\n            }\n         );\n      }\n   }\n\n   render() {\n      this.$amount.val(this.amount);\n      this.renderItems();\n   }\n\n   beforeSubmit() {\n      report('Donation', 'submitted', 'amount', this.amount);\n      const counts = {};\n      this.items.forEach((item) => {\n         counts[item.earmark] = (counts[item.earmark] || 0) + item.price;\n      });\n      const earmark = Object.keys(counts).sort((a, b) => counts[b] - counts[a])[0];\n      this.$earmark.val(earmark || '');\n   }\n\n   changeInfobox(view) {\n      this.$infoBlock\n         .attr('data-view', view)\n         .find('.view')\n         .hide()\n         .eq(view)\n         .show();\n   }\n\n   handleAmountChange() {\n      this.amount = +this.$amount.val();\n      report('Donation', 'changed', 'amount', this.amount);\n      this.renderItems();\n   }\n\n   handleAddition({ currentTarget = {} }) {\n      const name = currentTarget.innerText;\n      const price = +currentTarget.dataset.price;\n      const earmark = currentTarget.parentElement.dataset.earmark;\n      report('Donation', 'added', name, price);\n      this.addProduct({ name, price, earmark });\n   }\n\n   handleRemoval({ currentTarget = {} }) {\n      const name = currentTarget.innerText;\n      const price = +currentTarget.dataset.price;\n      report('Donation', 'removed', name, price);\n      this.removeProduct({ name, price });\n   }\n\n   addProduct(item) {\n      this.amount += item.price;\n      this.items = [...this.items, item].sort((a, b) => a.price - b.price);\n      this.render();\n      this.animate(this.$result, 'grow');\n   }\n\n   removeProduct({ name, price }) {\n      this.amount -= price;\n      const index = this.items.map(item => item.name).indexOf(name);\n      this.items.splice(index, 1);\n      this.render();\n   }\n\n   renderItems() {\n      const items = [...this.items];\n      const hasItems = !(this.amount > 0 || items.length);\n      const actualValue = this.$amount.val();\n      const itemTemplate = (item) => `<div class=\"item\" data-price=\"${item.price}\">\n                                         <span class=\"name\">${item.name}</span>\n                                      </div>`;\n      let targetValue = this.calculateAmount();\n\n      this.$resultMore.toggleClass('hidden', hasItems);\n      this.$donateButton.attr('disabled', hasItems);\n\n      if (items.length && actualValue < targetValue) {\n         const partlyOff = (item) => `<div class=\"item\"><span class=\"name\">${item.name}</span>\n                                       <div class=\"price\">${item.newPrice}&nbsp;€\n                                          <span class=\"strike\">${item.price}&nbsp;€</span>\n                                       </div>\n                                    </div>`;\n         const fullyOff = (item) => `<div class=\"item strike\">\n                                        <span class=\"name\">${item.name}</span>\n                                        <span data-price=\"${item.price}\"></span>\n                                     </div>`;\n\n         const html = items.map((item) => {\n            const difference = targetValue - actualValue;\n\n            if (!difference) {\n               return itemTemplate(item); // normal\n            }\n\n            if (difference < item.price) { // partly off\n               targetValue -= difference;\n               item.newPrice = item.price - difference;\n               return partlyOff(item);\n            }\n\n            targetValue -= item.price;\n            return fullyOff(item); // fully off\n         }).join('');\n         this.$items.html(html);\n         return;\n      }\n\n      if (actualValue > targetValue) {\n         items.push({\n            name: this.bonusName,\n            price: actualValue - targetValue,\n         });\n      }\n\n      const itemsHtml = items.map(itemTemplate).join('');\n      const html = items.length ? itemsHtml : '';\n      this.$items.html(html);\n   }\n\n   calculateAmount() {\n      return this.items\n         .map(item => item.price)\n         .reduce((sum, price) => sum + price, 0);\n   }\n\n   animate($element, className, callback = this.$.noop) {\n      $element.addClass(className);\n      $element.one('animationend', () => {\n         $element.removeClass(className);\n         callback();\n      });\n   }\n\n   runSVGAnimation(id = '', onReady = this.$.noop, callback = this.$.noop) {\n      const settings = window.config.vivusSettings;\n      settings.onReady = onReady;\n      this.vivus = new Vivus(id, settings, callback);\n   }\n\n   adjustMarkerContentPositions() {\n      this.$marker.find('.pin .content').each((index, element) => {\n         element.parentElement.style.display = 'block';\n         const bounds = element.getBoundingClientRect();\n         element.parentElement.style.display = '';\n         if (bounds.left < 0) {\n            element.style.left = `${Math.abs(bounds.left)}px`;\n         }\n         else if (window.innerWidth - bounds.right < 0) {\n            element.style.right = `${bounds.right - window.innerWidth}px`;\n         }\n      });\n   }\n\n}\n\n$(() => window.app = new App()); // eslint-disable-line no-return-assign\n"]}